version: '3.8'

services:  

  smics_core:
    build:
        context: .
    container_name: smics_core
    volumes:
      - /home/smics/.aspnet/https/:/root/app/Certificates/
    environment:
      - OPENEHR_DB=https://medic-c-t.mh-hannover.local:8083/rest/openehr/v1
      - AUTHORITY=https://keycloak.mh-hannover.local:8443/auth/realms/Better
      - CLIENT_ID=medic-c-t
      - CLIENT_SECRET=null
      - ASPNETCORE_URLS="https://+;http://+"
      - ASPNETCORE_HTTPS_PORT=443
      - ASPNETCORE_Kestrel__Certificates__Default__Password={certPW}
      - ASPNETCORE_Kestrel__Certificates__Default__Path=/root/smics/https/cert.pfx
    ports:
      - "80:80"
      - "443:443"
    networks: 
        - smics-net

  smics_visualisierung:
    depends_on: smics_core
    build: ./SmICSVisualisierung
    environment:
      - USE_AUTH=true
      - SMICS_HOSTNAME=smics.mh-hannover.local
      - SMICS_PORT=443
      - AUTH_PROVIDER_URL=https://keycloak.mh-hannover.local:8443
      - AUTH_REALM=Better
      - AUTH_CLIENT_ID=medic-c-t
      #- AUTH_CLIENT_SECRET=
    ports:
      - "3231:3231"
    container_name: smics_visualisierung
    networks: 
     - smics-net

networks:
  smics-net: {}

